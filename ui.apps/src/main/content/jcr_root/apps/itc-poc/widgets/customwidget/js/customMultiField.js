CQ.form.customMultiField=CQ.Ext.extend(CQ.form.MultiField,{border:false,constructor:function(b){var c=this;if(typeof b.orderable==="undefined"){b.orderable=true}if(!b.fieldConfig){b.fieldConfig={}}if(!b.fieldConfig.xtype){b.fieldConfig.xtype="textfield"}b.fieldConfig.name=b.name;b.fieldConfig.ownerCt=this;b.fieldConfig.orderable=b.orderable;b.fieldConfig.dragDropMode=b.dragDropMode;if(!b.addItemLabel){b.addItemLabel=CQ.I18n.getMessage("Add Item")}var a=new Array();if(b.readOnly){b.fieldConfig.readOnly=true}else{a.push({xtype:"toolbar",cls:"cq-multifield-toolbar",items:["->",{xtype:"textbutton",text:b.addItemLabel,style:"padding-right:6px",handler:function(){c.addItem()}},{xtype:"button",iconCls:"cq-multifield-add",template:new CQ.Ext.Template('<span><button class="x-btn" type="{0}"></button></span>'),handler:function(){c.addItem()}}]})}this.hiddenDeleteField=new CQ.Ext.form.Hidden({name:b.name+CQ.Sling.DELETE_SUFFIX});a.push(this.hiddenDeleteField);if(b.typeHint){this.typeHintField=new CQ.Ext.form.Hidden({name:b.name+CQ.Sling.TYPEHINT_SUFFIX,value:b.typeHint+"[]"});a.push(this.typeHintField)}b=CQ.Util.applyDefaults(b,{defaults:{xtype:"customMultiFieldItem",fieldConfig:b.fieldConfig},items:[{xtype:"panel",border:false,bodyStyle:"padding:"+this.bodyPadding+"px",items:a}]});CQ.form.MultiField.superclass.constructor.call(this,b);if(this.defaults.fieldConfig.regex){this.defaults.fieldConfig.regex=b.fieldConfig.regex}this.addEvents("change","removeditem")},processRecord:function(a,c){if(this.fireEvent("beforeloadcontent",this,a,c)!==false){var b=a.get(this.getName());if(b==undefined&&this.defaultValue!=null){this.setValue(this.defaultValue)}else{this.setValue(b)}this.fireEvent("loadcontent",this,a,c)}},addItem:function(a){var c=this;var b=this.insert(this.items.getCount()-1,{});this.findParentByType("form").getForm().add(b.field);b.field.setValue(a);this.doLayout()},setValue:function(g){this.fireEvent("change",this,g,this.getValue());var h=this.items;h.each(function(i){if(i instanceof CQ.form.MultiField.Item){this.remove(i,true);this.findParentByType("form").getForm().remove(i)}},this);this.doLayout();if((g!=null)&&(g!="")){var e={};var m=new Array();var c=false;var a=0;for(var k in g){if(g[k] instanceof Array||CQ.Ext.isArray(g[k])){c=true}m[a]=k;a++}var f="";if(c){for(var b=0;g[m[0]].length;b++){for(var d=0;d<m.length;d++){f=g[m[d]][b].slice();if(typeof f!==undefined){e[m[d]]=f}}this.addItem(e)}}else{for(var l=0;l<m.length;l++){f=g[m[l]].slice();if(typeof f!==undefined){e[m[l]]=f}}this.addItem(e)}}},inBounds:function(a,b){if((a.length)>b){return a[b]}else{return""}}});CQ.Ext.reg("customMultiField",CQ.form.customMultiField);CQ.form.customMultiField.Item=CQ.Ext.extend(CQ.form.MultiField.Item,{constructor:function(a){CQ.form.customMultiField.Item.superclass.constructor.call(this,a)},reorder:function(e){var d=[];var b=[];if(e.field&&this.field){var a=e.field.getValue();var c=this.field.getValue();for(var f in a){if(!isNaN(parseInt(f))&&isFinite(f)){d[f]=a[f]}}for(var f in c){if(!isNaN(parseInt(f))&&isFinite(f)){b[f]=c[f]}}this.processOrder(e.field,b);this.processOrder(this.field,d)}},processOrder:function(a,c){var d=a.findByType("textfield");d=d.concat(a.findByType("richtext"));for(var b=0;b<d.length;b++){d[b].setValue(c[b]);d[b].fireEvent("change")}}});CQ.Ext.reg("customMultiFieldItem",CQ.form.customMultiField.Item);